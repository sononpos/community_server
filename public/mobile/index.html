<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<meta name="author" content="www.frebsite.nl" />
		<meta name="viewport" content="width=device-width initial-scale=1.0 maximum-scale=1.0 user-scalable=yes" />

		<title>모바일</title>

		<link type="text/css" rel="stylesheet" href="css/demo.css" />
		<link type="text/css" rel="stylesheet" href="css/base.css" />
		<link rel="stylesheet" href="css/swiper.min.css">
		<link type="text/css" rel="stylesheet" href="css/jquery.mmenu.all.css" />
		<link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css" />

		<style>
			.swiper-container {
	        width: 100%;
	        height: 40px;
	        margin: 0 auto;
					background-color: #f3f3f3;
	    }
	    .swiper-slide {
	        text-align: center;
	        font-size: 15px;
	        width: auto;
					min-width: 50px;
	        /* Center slide text vertically */
	        display: -webkit-box;
	        display: -ms-flexbox;
	        display: -webkit-flex;
	        display: flex;
	        -webkit-box-pack: center;
	        -ms-flex-pack: center;
	        -webkit-justify-content: center;
	        justify-content: center;
	        -webkit-box-align: center;
	        -ms-flex-align: center;
	        -webkit-align-items: center;
	        align-items: center;
	    }

			.content {padding : 0;}

		</style>

		<script type="text/javascript" src="http://code.jquery.com/jquery-2.2.0.js"></script>
		<script type="text/javascript" src="js/jquery.mmenu.all.min.js"></script>
		<script src="js/swiper.min.js"></script>


		<script src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>

		<script type="text/javascript">
			$(function() {
				$('nav#menu').mmenu();
			});
		</script>
	</head>
	<body>
		<div id="page">
			<div class="header">
				<a href="#menu"><span></span></a>
				핫 커뮤니티
			</div>

			<!-- Swiper -->
	    <div class="swiper-container">
        <div class="swiper-wrapper">

        </div>
        <!-- Add Scrollbar -->
        <div class="swiper-scrollbar"></div>
	    </div>

	    <!-- Initialize Swiper -->
	    <script>

				$.getJSON("/list", function(data) {
					$.each(data, function(key, value) {
						// 상단 탭 메뉴 추가
						$(".swiper-wrapper").append('<div class="swiper-slide"><a href="javascript:get_menu_list(\''+key+'\', \'1\');">'+ value.name +'</a></div>');

						// 왼쪽 네비게이션 메뉴 추가
						$("#menu ul").append('<li><a href="javascript:get_menu_list(\''+key+'\', \'1\');">'+value.name+'</a></li>');
					})
				}).done(function() {
					var swiper = new Swiper('.swiper-container', {
			        scrollbar: '.swiper-scrollbar',
			        scrollbarHide: true,
			        slidesPerView: 'auto',
			        centeredSlides: true,
			        spaceBetween: 30,
			        grabCursor: true
			    });
				});

	    </script>

			<div class="content">
				<ul id="comm_list" data-role="listview" data-inset="true">

				</ul>
			</div>
			<nav id="menu">
				<ul>

				</ul>
			</nav>
			<input id="current_key" type="hidden" name="current_key" />
			<input id="current_next" type="hidden" name="current_next" />
		</div>

		<script type="text/javascript">
			// 스크롤 끝
			$(document).ready(function() {
				$(window).scroll(function() {
					if($(window).scrollTop() == $(document).height() - $(window).height()) {

		 				get_menu_list($("#current_key").val(), $("#current_next").val());
					}
				});
			});

			function get_menu_list(key, index) {
				$.getJSON("/"+ key + "/" + index, function(data) {

					$("#current_key").val(key);

					$.each(data, function(key, value) {
						if(index == '1') {
							$(".content ul").html("");
						}

						$("#current_next").val(value.next_url);

						// 리스트
						$.each(value.list, function(key, value2) {
							$(".content ul").append('<li><a href="'+value2.link+'"><h2>'+value2.title+'</h2><p>'+ value2.username + " " + value2.regdate + " 조회수:" + value2.viewcnt +'</p></a></li>');
						})

					})
				}).done(function() {
					$("#comm_list").listview("refresh");
				});
			}

		</script>

	</body>
</html>
